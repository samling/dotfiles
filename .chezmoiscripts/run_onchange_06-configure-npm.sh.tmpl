#!/usr/bin/env bash

{{- $osID := "" -}}
{{- if (hasKey .chezmoi.osRelease "idLike") -}}
{{-   $osID = .chezmoi.osRelease.idLike -}}
{{- else if eq .chezmoi.os "darwin" -}}
{{-   $osID = "darwin" -}}
{{- end }}

echo "Configuring npm using fnm for {{ $osID }}..."

# Install fnm if not already installed
FNM_BIN=""
if ! command -v fnm &> /dev/null; then
    echo "Installing fnm"
    curl -fsSL https://fnm.vercel.app/install | bash
    
    # Source fnm in current shell
    FNM_BIN=$(which fnm)
    eval "$(${FNM_BIN} env --use-on-cd)"
fi

# Install latest LTS version of Node.js
echo "Installing latest npm"
fnm install --lts 
