#!/usr/bin/env bash

{{- $osID := .system.os_type }}

echo "Configuring asdf for {{ $osID }}..."

# Check if asdf is already installed
if ! command -v asdf &> /dev/null; then
    echo "Installing asdf..."
    yay -Syy --noconfirm asdf-vm
else
    echo "asdf is already installed"
fi

# Verify asdf is now available
if ! command -v asdf &> /dev/null; then
    echo "Error: asdf installation failed or not found in PATH"
    echo "Trying alternative paths..."
else
    ASDF_PATH="asdf"
fi

# Enable plugins
asdf plugin add golang

# List plugins
asdf plugin list

# Install plugins
LATEST_GO_1_24=$(asdf list all golang | grep 1.24 | grep -v rc | tail -n -1)
LATEST_GO_1_25=$(asdf list all golang | grep 1.25 | grep -v rc | tail -n -1)
LATEST_GO=$(asdf list all golang | grep -v rc | sed '/^[[:space:]]*$/d' | tail -n -1)

echo "Installing Go ${LATEST_GO_1_24}"
echo "========================="
$ASDF_PATH install golang ${LATEST_GO_1_24}
echo ""

echo "Installing Go ${LATEST_GO_1_25}"
echo "========================="
$ASDF_PATH install golang ${LATEST_GO_1_25}
echo ""

echo "Installing Go ${LATEST_GO}"
echo "========================="
$ASDF_PATH install golang ${LATEST_GO}
echo ""

# Use latest
echo "Setting latest Go version ${LATEST_GO} as global default"
$ASDF_PATH set --home golang latest
echo ""
